{% extends 'templates/tool-base.html' %}

{% set title = "template-transclusions" %}
{% set desc = "get the list of pages transcluding a page/template" %}

{% block styles%}
<link rel="stylesheet" href="https://tools-static.wmflabs.org/cdnjs/ajax/libs/bootstrap-select/1.13.18/css/bootstrap-select.min.css" crossorigin="anonymous" />
{% endblock %}

{% block tool %}
{% raw %}
<section class="container">
    <div id="app">
        <form>
            <div class="form-group">
                <label for="textInputField">Get transclusions of</label>
                <input class="form-control" type="text" id="textInputField" v-model.trim="text" v-bind:disabled="isRunning">
                <small class="text-muted form-text">Title is case-sensitive, include namespace prefix if applicable</small>
            </div>

            <ns-picker v-model="selectedNS"></ns-picker>

            <input type="button" value="Fetch" class="btn btn-primary" v-on:click.prevent="generate" v-bind:disabled="isRunning">
            <span class="spinner-border spinner-border-sm text-primary" role="status" aria-hidden="true" v-show="isRunning"></span>
        </form>

        <div class="card mt-4" v-show="showResult">
            <div class="card-header">Result</div>
            <div class="card-body">
                <pre>{{result}}</pre>
            </div>
        </div>
    </div>
</section>
{% endraw %}
{% endblock %}

{% block scripts %}
{% raw %}
<script src="https://tools-static.wmflabs.org/cdnjs/ajax/libs/axios/0.19.2/axios.min.js" crossorigin="anonymous"></script>
<script src="https://tools-static.wmflabs.org/cdnjs/ajax/libs/bootstrap-select/1.13.18/js/bootstrap-select.min.js" crossorigin="anonymous"></script>
<script type="module">
    import JSWiki from "/jswiki.js";
    import { nsPicker } from "/comps.js";

    new Vue({
        el: "#app",
        data: {
            text: "",
            showResult: false,
            result: "",
            isRunning: false,
            selectedNS: []
        },
        components: {
            "ns-picker": nsPicker
        },
        methods: {
            generate() {
                if (!this.text)
                    return;

                this.isRunning = true;
                this.result = "";

                JSWiki.transclusions(this.text, this.selectedNS).then(m => {
                    if (m && m.has(this.text))
                        this.result = m.get(this.text).join("\n");

                    this.isRunning = false;
                    this.showResult = true;
                });
            }
        }
    });
</script>
{% endraw %}
{% endblock %}